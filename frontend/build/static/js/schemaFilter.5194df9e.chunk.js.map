{"version":3,"file":"static/js/schemaFilter.5194df9e.chunk.js","mappings":"gLA8CM,SAAUA,EACdC,EACAC,GAEA,SAASC,EAAOC,GACd,IAAMC,EAAOJ,EACPK,EAAKF,EAAIG,MAAMA,MAErB,GAAIF,GAAQC,EAAI,CACd,IAAME,EAAYH,EAAKC,GACvB,KAAKG,EAAAA,EAAAA,GAAmBJ,EAAMG,GAM5B,OALAJ,EAAIM,YAAY,gBAAcC,EAAAA,EAAAA,KAAAA,EAAAA,EAAAA,IAAA,GACzBP,EAAIG,MAAMK,cAAY,CACzBC,KAAK,EACL,cAAc,KAETT,EAEP,IAAMU,EAzDd,SACET,EACAH,G,QAEA,IAAKG,IAASU,OAAOC,KAAKX,GACxB,MAAO,CAAC,EAGV,IAAMY,EAAuBZ,EAAKO,aAC9BG,OAAOC,KAAKX,EAAKO,cAAcT,OAC7B,SAACe,GAAM,OAA0B,IAA1Bb,EAAKO,aAAcM,EAAnB,GAET,GAIEC,EAAkC,GASxC,OARwB,QAAtBC,EAAAlB,EAASmB,qBAAa,IAAAD,EAAAA,EAAI,IAAIE,QAAQ,SAACC,GACvCN,EAAqBK,QAAQ,SAACE,GACxBD,EAAEE,cAAgBD,GACpBL,EAAsBO,KAAKH,EAAEI,KAEjC,EACF,IAE8B,QAAtBC,EAAA1B,EAASmB,qBAAa,IAAAO,EAAAA,EAAI,IAAIC,OAAO,SAACC,EAAKP,GAUjD,OATIA,EAAErB,SAAwB,eACxBiB,EAAsBY,SAASR,EAAEI,OAEnCJ,EAAErB,SAAwB,cAAEoB,QAE1B,SAACU,GAAQ,OAACF,EAAI,GAAAG,OAAGV,EAAEI,KAAI,KAAAM,OAAID,EAAIE,iBAAmB,CAAzC,GAIRJ,CACT,EAAG,CAAC,EACN,CAoBgCK,CAA2B3B,EAAWN,GAE9DE,EAAIM,YAAY,gBAAcC,EAAAA,EAAAA,KAAAA,EAAAA,EAAAA,KAAAA,EAAAA,EAAAA,IAAA,GACzBP,EAAIG,MAAMK,cACD,OAATJ,QAAS,IAATA,OAAS,EAATA,EAAWI,cACXE,G,CAKT,OAAOV,CACT,CAEA,MAAO,CACLuB,KAAM,gBACNS,QAAS,QACTC,SAAU,WAAM,UAChBC,KAAM,WAAM,OAAAC,QAAQC,SAAR,EACZC,KAAM,SACNC,KAAMvC,EACNwC,MAAOxC,EACPF,MAAOE,EACPyC,SAAUzC,EACV0C,MAAO1C,EAEX,C,iBCjFM,SAAUM,EACdJ,EACAG,G,QAGA,MAAkC,mBAAd,OAATA,QAAS,IAATA,OAAS,EAATA,EAAWsC,SACbtC,EAAUsC,QAIY,QAAxBlB,EAAe,QAAfR,EAAI,OAAJf,QAAI,IAAJA,OAAI,EAAJA,EAAM0C,iBAAS,IAAA3B,OAAA,EAAAA,EAAE0B,eAAO,IAAAlB,GAAAA,CACjC,C","sources":["../node_modules/@segment/analytics-next/src/plugins/schema-filter/index.ts","../node_modules/@segment/analytics-next/src/lib/is-plan-event-enabled.ts"],"sourcesContent":["import { CDNSettings } from '../../browser'\nimport { Context } from '../../core/context'\nimport { PlanEvent, TrackPlan } from '../../core/events/interfaces'\nimport { Plugin } from '../../core/plugin'\nimport { isPlanEventEnabled } from '../../lib/is-plan-event-enabled'\nimport { RemotePlugin } from '../remote-loader'\n\nfunction disabledActionDestinations(\n  plan: PlanEvent | undefined,\n  settings: CDNSettings\n): { [destination: string]: string[] } {\n  if (!plan || !Object.keys(plan)) {\n    return {}\n  }\n\n  const disabledIntegrations = plan.integrations\n    ? Object.keys(plan.integrations).filter(\n        (i) => plan.integrations![i] === false\n      )\n    : []\n\n  // This accounts for cases like Fullstory, where the settings.integrations\n  // contains a \"Fullstory\" object but settings.remotePlugins contains \"Fullstory (Actions)\"\n  const disabledRemotePlugins: string[] = []\n  ;(settings.remotePlugins ?? []).forEach((p: RemotePlugin) => {\n    disabledIntegrations.forEach((int) => {\n      if (p.creationName == int) {\n        disabledRemotePlugins.push(p.name)\n      }\n    })\n  })\n\n  return (settings.remotePlugins ?? []).reduce((acc, p) => {\n    if (p.settings['subscriptions']) {\n      if (disabledRemotePlugins.includes(p.name)) {\n        // @ts-expect-error element implicitly has an 'any' type because p.settings is a JSONObject\n        p.settings['subscriptions'].forEach(\n          // @ts-expect-error parameter 'sub' implicitly has an 'any' type\n          (sub) => (acc[`${p.name} ${sub.partnerAction}`] = false)\n        )\n      }\n    }\n    return acc\n  }, {})\n}\n\nexport function schemaFilter(\n  track: TrackPlan | undefined,\n  settings: CDNSettings\n): Plugin {\n  function filter(ctx: Context): Context {\n    const plan = track\n    const ev = ctx.event.event\n\n    if (plan && ev) {\n      const planEvent = plan[ev]\n      if (!isPlanEventEnabled(plan, planEvent)) {\n        ctx.updateEvent('integrations', {\n          ...ctx.event.integrations,\n          All: false,\n          'Segment.io': true,\n        })\n        return ctx\n      } else {\n        const disabledActions = disabledActionDestinations(planEvent, settings)\n\n        ctx.updateEvent('integrations', {\n          ...ctx.event.integrations,\n          ...planEvent?.integrations,\n          ...disabledActions,\n        })\n      }\n    }\n\n    return ctx\n  }\n\n  return {\n    name: 'Schema Filter',\n    version: '0.1.0',\n    isLoaded: () => true,\n    load: () => Promise.resolve(),\n    type: 'before',\n    page: filter,\n    alias: filter,\n    track: filter,\n    identify: filter,\n    group: filter,\n  }\n}\n","import { PlanEvent, TrackPlan } from '../core/events/interfaces'\n\n/**\n * Determines whether a track event is allowed to be sent based on the\n * user's tracking plan.\n * If the user does not have a tracking plan or the event is allowed based\n * on the tracking plan configuration, returns true.\n */\nexport function isPlanEventEnabled(\n  plan: TrackPlan | undefined,\n  planEvent: PlanEvent | undefined\n): boolean {\n  // Always prioritize the event's `enabled` status\n  if (typeof planEvent?.enabled === 'boolean') {\n    return planEvent.enabled\n  }\n\n  // Assume absence of a tracking plan means events are enabled\n  return plan?.__default?.enabled ?? true\n}\n"],"names":["schemaFilter","track","settings","filter","ctx","plan","ev","event","planEvent","isPlanEventEnabled","updateEvent","__assign","integrations","All","disabledActions","Object","keys","disabledIntegrations","i","disabledRemotePlugins","_a","remotePlugins","forEach","p","int","creationName","push","name","_b","reduce","acc","includes","sub","concat","partnerAction","disabledActionDestinations","version","isLoaded","load","Promise","resolve","type","page","alias","identify","group","enabled","__default"],"sourceRoot":""}